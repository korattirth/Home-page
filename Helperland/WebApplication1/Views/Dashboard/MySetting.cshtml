@{ ViewData["Title"] = "My Setting";}
@model ApplicationUser
<div class="welcome_div">
    <h1 class="welcome_text">Welcome,<span style="font-weight: bold;">Sandip!</span> </h1>
</div>

<!-- middle section -->
<section>
    <div class="middle_section">
        <div class="main_div">
            <div class="perent_div">
                <div class="child_div_1">
                    <div>
                        <a asp-controller="Dashboard" asp-action="ServicesHistory" style="text-decoration:none">
                            <div class="services">
                                <p class="services_text">Services History</p>
                            </div>
                        </a>
                        <a asp-controller="Dashboard" asp-action="ServicesHistory" style="text-decoration:none">
                            <div class="services">
                                <p class="services_text">Services History</p>
                            </div>
                        </a>
                        <div class="services">
                            <p class="services_text">Services Schedule</p>
                        </div>
                        <div class="services">
                            <p class="services_text">Favorite Pros</p>
                        </div>
                        <div class="services">
                            <p class="services_text">Invoices</p>
                        </div>
                        <div class="services">
                            <p class="services_text">Notification</p>
                        </div>
                    </div>
                </div>
                <div class="child_div_2">
                    <div>
                        <div class="d-flex text-center">
                            <p class="Top_header active" style="cursor: pointer;" id="hader1">My Details</p>
                            <p class="Top_header" style="cursor: pointer;" onclick="address()" id="hader2">My Address</p>
                            <p class="Top_header" style="cursor: pointer;" onclick="password()" id="hader3">Change password</p>
                        </div>
                    </div>
                    <!--My Details -->
                    <section id="myDetails">
                        <div class="alert alert-success alert-dismissible d-none" id="successDivDetails">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <strong>Success!</strong> Your Password Is Updated.
                        </div>
                        <div class="row mt-3">
                            <div class="col-4">
                                <input id="userId" hidden value="@Model.Id" />
                                <label for="" class="m-0 lable_text">First Name</label><br>
                                <input type="text" value="@Model.FirstName" id="firstName" /><br />
                                <span class="text-danger" id="firstNameValidation"></span>
                            </div>
                            <div class="col-4">
                                <label for="" class="m-0 lable_text">Last Name</label><br>
                                <input type="text" value="@Model.LastName" id="lastName" /><br />
                                <span class="text-danger" id="lastNameValidation"></span>
                            </div>
                            <div class="col-4">
                                <label for="" class="m-0 lable_text">Email Address</label><br>
                                <input type="email" value="@Model.Email" id="email" /><br />
                                <span class="text-danger" id="emailValidation"></span>
                            </div>
                        </div>
                        <div class="row mb-5 mt-3">
                            <div class="col-4">
                                <label for="" class="m-0 lable_text">Phone Number</label><br>
                                <input type="number" value="@Model.PhoneNumber" id="phoneNumber" /><br />
                                <span class="text-danger" id="phoneValidation"></span>
                            </div>
                            <div class="col-4">
                                <label for="" class="m-0 lable_text">Date Of Birth</label><br>
                                <input type="date" id="dateOfBirth" value="@Model.DateOfBirth" /><br />
                                <span class="text-danger" id="dateOfBirthValidation"></span>
                            </div>
                        </div>
                        <div style="border-bottom: 2px solid #646464;"></div>
                        <div class="mt-2">
                            <label class="mb-1 lable_text">My Prefer Language</label><br>
                            <select id="language">
                                <option value="1">English</option>
                                <option value="2">Hindi</option>
                            </select><br>
                            <span class="text-danger" id="languageValidation"></span><br />
                            <button class="btn mt-2" style="background-color: #1d7a8c;color: white;" id="saveDetails">Save</button>
                        </div>
                    </section>
                    <!-- Address -->
                    <section id="address" class="d-none">
                        <div>
                            <table class="border w-100">
                                <thead>
                                    <tr class="border" style="background-color: #dadada;color: #646464;">
                                        <th style="width: 85%;" class="pl-3 p-2">Address</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="forAddress">
                                </tbody>
                            </table>
                            <button class="btn mt-2" style="background-color: #1d7a8c;color: white;" onclick="EditAddress()">Add New Address</button>
                        </div>
                    </section>
                    <!-- change password -->
                    <section id="password" class="d-none">
                        <div class="alert alert-success alert-dismissible d-none" id="successDiv">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <strong>Success!</strong> Your Password Is Updated.
                        </div>
                        <div class="alert alert-danger alert-dismissible d-none" id="ErrorDiv">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <strong>Danger!</strong> Please Enter Valid Password.
                        </div>
                        <div>
                            <label for="" class="m-0 lable_text">Current Password</label><br>
                            <input type="password" id="currentPassword" /><br />
                            <span id="currentPasswordValidation" class="text-danger"></span>
                        </div>
                        <div class="mt-3">
                            <label for="" class="m-0 lable_text">New Password</label><br>
                            <input type="password" id="NewPassword" /><br />
                            <span id="NewPasswordValidation" class="text-danger"></span>
                        </div>
                        <div class="mt-3">
                            <label for="" class="m-0 lable_text">Confirm Password</label><br>
                            <input type="password" id="confirmPassword" /><br />
                            <span id="confirmPasswordValidation" class="text-danger"></span>
                        </div>
                        <button type="reset" class="btn mt-3" style="background-color: #1d7a8c;color: white;" onclick="UpdatePassword()">Save</button>
                    </section>
                </div>
            </div>
        </div>
        <!--Edit Address -->
        <div class="position-absolute border d-none" style="background-color: rgb(243, 243, 243);" id="EditAddress">
            <div class="p-3">
                <div class="d-flex justify-content-between mb-3">
                    <p class="m-0 lable_text" style="font-size: 22px;">Edit Address</p>
                    <i class="fa fa-times" aria-hidden="true" onclick="closeAddressDiv()" style="cursor: pointer;"></i>
                </div>
                <div>
                    <div class="row">
                        <div class="col-6">
                            <label for="" class="lable_text m-0">Street Name</label><br>
                            <input type="text" id="streetName"><br />
                            <span id="streetNameValidation" class="text-danger"></span>
                        </div>
                        <div class="col-6">
                            <label for="" class="lable_text m-0">House Name</label><br>
                            <input type="text" id="houseNumber"><br />
                            <span id="houseNameValidation" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label for="" class="lable_text m-0">Postal Code</label><br>
                            <input type="number" id="postalCode"><br />
                            <span id="postalCodeValidation" class="text-danger"></span>
                        </div>
                        <div class="col-6">
                            <label for="" class="lable_text m-0">City</label><br>
                            <input type="text" id="city"><br />
                            <span id="cityValidation" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label for="" class="lable_text m-0">Phone Number</label><br>
                            <input type="tel" id="phone"><br />
                            <span id="callValidation" class="text-danger"></span>
                        </div>
                    </div>
                    <button type="reset" class="btn mt-3 w-100" style="background-color: #1d7a8c;color: white;" id="addAddress">Edit</button>
                </div>
            </div>
        </div>
        @*Update Address*@
        <div class="position-absolute border d-none" style="background-color: rgb(243, 243, 243);" id="currentAddress">
            <div class="p-3">
                <div class="d-flex justify-content-between mb-3">
                    <p class="m-0 lable_text" style="font-size: 22px;">Edit Address</p>
                    <i class="fa fa-times" aria-hidden="true" id="curretnAddressClose" style="cursor: pointer;"></i>
                </div>
                <div>
                    <div class="row">
                        <div class="col-6">
                            <label for="" class="lable_text m-0">Street Name</label><br>
                            <input type="text" id="CurrentstreetName"><br />
                            <span id="CurrentstreetNameValidation" class="text-danger"></span>
                        </div>
                        <div class="col-6">
                            <label for="" class="lable_text m-0">House Name</label><br>
                            <input type="text" id="CurrenthouseNumber"><br />
                            <span id="CurrenthouseNameValidation" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label for="" class="lable_text m-0">Postal Code</label><br>
                            <input type="number" id="CurrentpostalCode"><br />
                            <span id="CurrentpostalCodeValidation" class="text-danger"></span>
                        </div>
                        <div class="col-6">
                            <label for="" class="lable_text m-0">City</label><br>
                            <input type="text" id="Currentcity"><br />
                            <span id="CurrentcityValidation" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label for="" class="lable_text m-0">Phone Number</label><br>
                            <input type="tel" id="Currentphone"><br />
                            <span id="CurrentcallValidation" class="text-danger"></span>
                        </div>
                    </div>
                    <button type="reset" class="btn mt-3 w-100" style="background-color: #1d7a8c;color: white;" onclick="UpdateCurrentAddress(this.value)" id="CurrentUpdateAddress">Edit</button>
                </div>
            </div>
        </div>
        
    </div>
</section>

<style>
    /* welcome text */
    .welcome_div {
        height: 119px;
        margin-top: 70px;
        background-color: #F9F9F9;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .welcome_text {
        font-family: Roboto;
        font-size: 30px;
        font-weight: normal;
        font-stretch: normal;
        font-style: normal;
        line-height: 0.8;
        letter-spacing: normal;
        text-align: right;
        color: #4f4f4f;
    }
    /* middle section */
    .middle_section {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .main_div {
        width: 1200px;
    }

    .perent_div {
        display: flex;
        flex-wrap: wrap;
        margin-top: 31px;
        margin-bottom: 30px;
    }

    .child_div_1 {
        flex: 25%;
        background-color: #1d7a8c;
        margin-right: 31px;
    }

    .child_div_2 {
        flex: 70%;
    }

    .services {
        border-bottom: 1px solid rgba(255, 255, 255,0.2);
        height: 54px;
    }

    .services_text {
        font-family: Roboto;
        font-size: 18px;
        font-weight: normal;
        font-stretch: normal;
        font-style: normal;
        line-height: 3.06;
        letter-spacing: normal;
        text-align: left;
        color: white;
        margin-left: 15px;
    }

    .Top_header {
        width: 33.33%;
        border-bottom: 3px solid #646464;
        font-weight: 500;
        color: #565656;
    }

        .Top_header.active {
            border-bottom: 6px solid #1d7a8c;
        }

    .lable_text {
        font-size: 16px;
        font-weight: 500;
        color: #646464;
    }
    .btn-style-none {
        background: white !important;
        border: 0px solid white !important;
    }
</style>

@section scripts{
    <script>
        function EditAddress() {
            $("#EditAddress").removeClass("d-none");
        }
        @*Get Curretn Address*@
        function CurrentAddress(para) {
            $("#currentAddress").removeClass("d-none");
            $("#CurrentUpdateAddress").val(para);
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetAddressByAddressId")",
                data: { "AddressId": para },
                success: function (result) {
                    console.log(result)
                    $("#CurrentstreetName").val(result.streetName);
                    $("#CurrenthouseNumber").val(result.houseNumber);
                    $("#CurrentpostalCode").val(result.postalCode);
                    $("#Currentcity").val(result.city);
                    $("#Currentphone").val(result.phoneNumber);
                },
                error: function () {
                    console.log("Somthing Went Wong")
                }
            })

        }

        @*Get Address*@
        function address() {
                $("#currentAddress").addClass("d-none");
                $("#address").removeClass("d-none");
                $("#myDetails").addClass("d-none");
                $("#password").addClass("d-none")
                $("#EditAddress").addClass("d-none")
                $("#hader2").addClass("active")
                $("#hader1").removeClass("active")
                $("#hader3").removeClass("active")
                $.ajax({
                    type: "GET",
                    url: "@Url.Action("GetAddress")",
                    data: { "userId": $("#userId").val() },
                    success: function (result) {
                        $("#forAddress").empty();
                        for (var i = 0; i < result.length; i++) {
                            $("#forAddress").append('<tr><td><div class="p-3"> <p class="m-0" style="color: #646464;"><span style="font-weight: bold;">Address : </span> ' + result[i].streetName + ' ' + result[i].houseNumber + '  ' + result[i].postalCode + ' ' + result[i].city + ' </p><p class="m-0 " style="color: #646464;"><span style="font-weight: bold;">Phone Number : </span> ' + result[i].phoneNumber + '</p> </div></td><td><button class="fa fa-edit btn-style-none" style="font-size: 22px;cursor: pointer;background-color:none" onclick="CurrentAddress(this.value)" value = " ' + result[i].addressId + '"></button><button class="fa fa-trash ml-2 btn-style-none" style="font-size: 22px;cursor: pointer;" onclick="CancelAddress(this.value)" value = " ' + result[i].addressId + '"></button> </td>')
                        }
                    },
                    error: function () {
                        console.log("Somthing Went Wrong");
                    }
                })
        }

        @*Update Address*@
        function UpdateCurrentAddress(AddressId) {
                var streetName = $("#CurrentstreetName").val();
                var houseNumber = $("#CurrenthouseNumber").val();
                var city = $("#Currentcity").val();
                var postalCode = $("#CurrentpostalCode").val();
                var phoneNumber = $("#Currentphone").val();
                if (streetName == "") {
                    $("#CurrentstreetNameValidation").text("Strret Name Is Required");
                }
                if (houseNumber == "") {
                    $("#CurrenthouseNameValidation").text("House Number Is Required");
                }
                if (city == "") {
                    $("#CurrentcityValidation").text("City Is Required");
                }
                if (postalCode == "") {
                    $("#CurrentpostalCodeValidation").text("Postal Code Is Required");
                }
                if (phoneNumber == "") {
                    $("#CurrentcallValidation").text("Phone NumberIs Required");
                }
                else {
                    $.ajax({
                    type: "POST",
                    url: "@Url.Action("UpdateAddress")",
                    data: {
                        "streetName": streetName,
                        "houseNumber": houseNumber,
                        "city": city,
                        "postalCode": postalCode,
                        "phoneNumber": phoneNumber,
                        "AddressId": AddressId
                    },
                    success: function (result) {
                        address();
                    },
                    error: function () {
                        console.log("Somthing Went Wrong");
                    }
                })
                }
        }

        @*Cancel Address*@
        function CancelAddress(AddressId) {
            $.ajax({
                type: "POST",
                url: "@Url.Action("CancelAddress")",
                data: { "AddressId": AddressId },
                success: function (result) {
                    address();
                },
                error: function () {
                    console.log("Somthing Went Wrong");
                }
            })
        }

        @*UpdatePassWord*@
        function UpdatePassword() {
            var currentPassword = $("#currentPassword").val();
            var newPassword = $("#NewPassword").val();
            var confirmPassword = $("#confirmPassword").val();
            if (currentPassword == "") {
                $("#currentPasswordValidation").text("Please Enter Current Password")
            }
            if (newPassword == "") {
                $("#NewPasswordValidation").text("Please Enter New Password")
            }
            if (confirmPassword == "") {
                $("#confirmPasswordValidation").text("Please Enter Confirm Password")
            }
            if (confirmPassword != newPassword) {
                $("#confirmPasswordValidation").text("Please Match Confirm and New Password")
            }
            else {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("ChangePassword")",
                    data: { "CurrentPassword": currentPassword, "NewPassword": newPassword },
                    success: function (result) {
                        if (result) {
                            $("#successDiv").removeClass("d-none")
                        }
                        else {
                            $("#ErrorDiv").removeClass("d-none")
                        }
                    },
                    error: function () {
                        console.log("Somthing Went Wrong")
                    }
                })
            }

        }

        function closeAddressDiv() {
            $("#EditAddress").addClass("d-none");
        }
        $(document).ready(function () {
            $("#hader1").click(function () {
                $("#myDetails").removeClass("d-none");
                $("#address").addClass("d-none");
                $("#currentAddress").addClass("d-none");
                $("#EditAddress").addClass("d-none");
                $("#password").addClass("d-none")
                $("#hader1").addClass("active")
                $("#hader2").removeClass("active")
                $("#hader3").removeClass("active")
            })
            $("#hader3").click(function () {
                $("#address").addClass("d-none");
                $("#myDetails").addClass("d-none");
                $("#currentAddress").addClass("d-none");
                $("#EditAddress").addClass("d-none");
                $("#password").removeClass("d-none")
                $("#hader3").addClass("active")
                $("#hader2").removeClass("active")
                $("#hader1").removeClass("active")
            })
            $("#curretnAddressClose").click(function () {
                $("#currentAddress").addClass("d-none");
            })
            @*Update Details*@
            $("#saveDetails").click(function () {
                var firstName = $("#firstName").val();
                var lastName = $("#lastName").val();
                var email = $("#email").val();
                var phoneNumber = $("#phoneNumber").val();
                var dateOfBirth = $("#dateOfBirth").val();
                var language = $("#language").val();
                var userId = $("#userId").val();
                if (firstName == "") {
                    $("#firstNameValidation").text("First Name Is Required");
                }
                if (lastName == "") {
                    $("#lastNameValidation").text("Last Name Is Required");
                }
                if (email == "") {
                    $("#emailValidation").text("Email Is Required");
                }
                if (phoneNumber == "") {
                    $("#phoneValidation").text("Phone Is Required");
                }
                if (dateOfBirth == "") {
                    $("#dateOfBirthValidation").text("Date Of Birth Is Required");
                }
                if (language == "") {
                    $("#languageValidation").text("Language Is Required");
                }
                else {
                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("UpdateuserDetails")",
                        data: {
                            "firstName": firstName,
                            "lastName": lastName,
                            "email": email,
                            "phoneNumber": phoneNumber,
                            "dateOfBirth": dateOfBirth,
                            "language": language,
                            "userId": userId,
                        },
                        success: function (result) {
                            location.reload();
                            $("#successDivDetails").removeClass("d-none")
                        },
                        error: function () {
                            console.log("Somthing Wetn Wrong");
                        }
                    })
                }
            })
            @*Add Address*@
            $("#addAddress").click(function () {
                var streetName = $("#streetName").val();
                var houseNumber = $("#houseNumber").val();
                var city = $("#city").val();
                var postalCode = $("#postalCode").val();
                var phoneNumber = $("#phone").val();
                if (streetName == "") {
                    $("#streetNameValidation").text("Strret Name Is Required");
                }
                if (houseNumber == "") {
                    $("#houseNameValidation").text("House Number Is Required");
                }
                if (city == "") {
                    $("#cityValidation").text("City Is Required");
                }
                if (postalCode == "") {
                    $("#postalCodeValidation").text("Postal Code Is Required");
                }
                if (phoneNumber == "") {
                    $("#callValidation").text("Phone NumberIs Required");
                }
                else {
                    $.ajax({
                    type: "POST",
                    url: "@Url.Action("AddAddress")",
                    data: {
                        "streetName": streetName,
                        "houseNumber": houseNumber,
                        "city": city,
                        "postalCode": postalCode,
                        "phoneNumber": phoneNumber,
                        "userId": $("#userId").val()
                    },
                    success: function (result) {
                        address();
                    },
                    error: function () {
                        console.log("Somthing Went Wrong");
                    }
                })
                }
            })
        })
    </script>
}